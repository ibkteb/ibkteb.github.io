import{q as z,d as p,b as B,t as A,u as m,f as S,o as P,v as D,w as x,e as G,i as H,h as N,l as q,k as F,x as O,m as E,n as U}from"./indicator-CMPx_ztt.js";const I=document.getElementById("charSearch"),d=document.getElementById("searchResults"),C=document.getElementById("themeToggle"),o=document.getElementById("scriptSimp"),l=document.getElementById("scriptTrad");document.getElementById("loadMoreBtn");let M=[],y=0;const W=100;let $;async function _(){H(),N(),j(),Q(),await Promise.all([q(),F(),O()])}document.addEventListener("DOMContentLoaded",_);document.addEventListener("characterDataLoaded",v);document.addEventListener("scriptChanged",()=>{const e=I.value;e?w(e):v()});I.addEventListener("input",e=>{clearTimeout($),$=setTimeout(()=>w(e.target.value),150)});function j(){C&&C.addEventListener("click",()=>{const e=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)}),localStorage.getItem("theme")==="light"&&document.documentElement.setAttribute("data-theme","light")}function Q(){o&&l&&(o.addEventListener("click",()=>{E(!1),f()}),l.addEventListener("click",()=>{E(!0),f()}),f())}function f(){const e=U();o&&l&&(e?(o.classList.remove("active"),l.classList.add("active")):(o.classList.add("active"),l.classList.remove("active")))}function w(e){if(e=e.trim(),!e){v();return}const a=[],s=e.toLowerCase(),n=z(e);for(const t of p.characterData){if(t.char===e){a.push({...t,matchType:"char"});continue}if(t.pinyin.toLowerCase()===s||t.pinyinBase===n||t.pinyinBase.startsWith(n)){a.push({...t,matchType:"pinyin"});continue}if(t.zhuyin&&t.zhuyin.includes(e)){a.push({...t,matchType:"zhuyin"});continue}}const r=new Set,i=a.filter(t=>{const c=t.char+t.pinyin;return r.has(c)?!1:(r.add(c),!0)});i.sort((t,c)=>t.matchType==="char"&&c.matchType!=="char"?-1:c.matchType==="char"&&t.matchType!=="char"?1:t.pinyinBase===n&&c.pinyinBase!==n?-1:c.pinyinBase===n&&t.pinyinBase!==n?1:t.char.localeCompare(c.char,"zh-CN")),M=i,y=0,k()}function k(){const e=M,a=y,s=Math.min(a+W,e.length),n=e.slice(a,s),r=a===0;if(r&&n.length===0){d.innerHTML=`
            <div class="no-results">
                <div class="no-results-icon">üòï</div>
                <p>No characters found</p>
            </div>`;return}if(r){let t=`<div class="search-stats">Found ${e.length} result${e.length>1?"s":""} - Click to hear pronunciation</div>`;t+='<div class="char-grid" id="charGridResults">';for(const c of n)t+=g(c);t+="</div>",s<e.length&&(t+=`<button class="load-more-btn" id="loadMoreBtn">Load More (${e.length-s} remaining)</button>`),d.innerHTML=t}else{const t=document.getElementById("charGridResults");for(const u of n)t.insertAdjacentHTML("beforeend",g(u));const c=document.getElementById("loadMoreBtn");s<e.length?c.textContent=`Load More (${e.length-s} remaining)`:c&&c.remove()}y=s,R();const i=document.getElementById("loadMoreBtn");i&&(i.onclick=()=>k())}function v(){if(p.characterData.length===0)return;const e=new Map;for(const i of p.characterData)e.has(i.char)||e.set(i.char,i);const n=Array.from(e.values()).sort(()=>Math.random()-.5).slice(0,30);let r='<div class="search-stats" style="text-align:center;">‚ú® Random characters ‚Äî click to hear pronunciation, search to find more</div>';r+='<div class="char-grid">';for(const i of n)r+=g(i);r+="</div>",d.innerHTML=r,R()}function g(e){var L;const a=B.pinyinToWadeGiles[e.pinyinBase]||"",s=B.pinyinToTongyong[e.pinyinBase]||"",n=A(e.pinyin),r=a?`${a}${n&&n!=="5"?"<sup>"+n+"</sup>":""}`:"";let i=s;s&&n&&(n==="2"?i=m(s,"√°","√©","√≠","√≥","√∫","«ò"):n==="3"?i=m(s,"«é","ƒõ","«ê","«í","«î","«ö"):n==="4"?i=m(s,"√†","√®","√¨","√≤","√π","«ú"):n==="5"&&(i=s.replace(/([aeiou√º])/i,"$1Ãä")));let t=e.zhuyin||"";n==="5"&&t&&(t="Àô"+t.replace(/[ÀäÀáÀãÀô]/g,""));let c="";for(const h of S.rows){const T=h.cells.indexOf(e.pinyinBase);if(T!==-1){const b=S.onsets[T];c=`${((L=P[b])==null?void 0:L.replace(/\//g,""))||"‚àÖ"}-${h.medial}-${h.vowel}-${h.coda}`;break}}const u=D(e.char);return`
        <div class="char-card" data-char="${e.char}" data-pinyin="${e.pinyin}" data-zhuyin="${e.zhuyin}">
            <span class="char-play-btn">üîä</span>
            <span class="char-info-btn" data-char="${e.char}">‚ÑπÔ∏è</span>
            <div class="char-hanzi">${u}</div>
            <div class="char-structure">${c}</div>
            <div class="char-pinyin">${e.pinyin}</div>
            <div class="char-tongyong">${i}</div>
            <div class="char-wg">${r}</div>
            <div class="char-zhuyin">${t}</div>
        </div>`}function R(){d.querySelectorAll(".char-card").forEach(e=>{e.addEventListener("click",a=>{a.target.classList.contains("char-info-btn")||J(e)})}),d.querySelectorAll(".char-info-btn").forEach(e=>{e.addEventListener("click",a=>{a.stopPropagation(),x(e.dataset.char)})})}function J(e){const a=e.dataset.char,s=e.dataset.pinyin,n=e.dataset.zhuyin||"";e.classList.add("playing"),setTimeout(()=>e.classList.remove("playing"),500),G(a,s,n)}
